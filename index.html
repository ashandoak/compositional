<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Compositionality Interactive — Page 2</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>

<body data-page="2" data-prev="page1.html" data-next="page3.html">
  <div class="app">
    <div class="top">
      <h1>Compositionality Lesson - Motivation</h1>
        <p>
          <strong>Instructions:</strong> The code shown here is valid, but doesn't easily scale because of a mixing between concerns. 
          Click on individual lines of code below to see how looping logic, conditionals, and shared state are tightly interwoven.
          The rest of this exercise explores how compositional techniques make change safer and more predictable.
        </p>
      </div>
    <div class="main page2-grid">
      <div class="page2-spacer" aria-hidden="true"></div>

      <!-- Center: code (hero panel like Page 1 workspace) -->
      <section class="panel page2-hero" aria-label="Annotated code">
        <div class="panel-header">
          <div class="title">Annotated code</div>
          <div class="pill">Click highlights</div>
        </div>

        <div class="panel-body">
          <div class="code-note">
            <div><strong>nums = [1, 2, 3, 4, 5, 6]</strong></div>
          </div>

          <div class="codebox" aria-label="Code listing">
            <div class="line hl" data-key="mixed" aria-label="Mixed concerns (whole loop)">
              <span class="gutter">1</span>
              <span class="content">total = 0</span>
            </div>
            <div class="line hl" data-key="mixed" aria-label="Mixed concerns (whole loop)">
              <span class="gutter">2</span>
              <span class="content">for x in nums:</span>
            </div>
            <div class="line hl" data-key="predicate" aria-label="Hidden decision logic">
              <span class="gutter">3</span>
              <span class="content">    if x % 2 == 0:</span>
            </div>
            <div class="line hl" data-key="transform" aria-label="Transformation tied to control flow">
              <span class="gutter">4</span>
              <span class="content">        y = x * x</span>
            </div>
            <div class="line hl" data-key="aggregate" aria-label="Aggregation coupled to iteration">
              <span class="gutter">5</span>
              <span class="content">        total += y</span>
            </div>
            <div class="line hl" data-key="mixed" aria-label="Mixed concerns (whole loop)">
              <span class="gutter">6</span>
              <span class="content">print(total)</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Right: “bubble space” (like Page 1 code cards area) -->
      <section class="panel page2-bubbles" aria-label="Explanation bubbles">
        <div class="panel-header">
          <div class="title">Explanation</div>
          <div class="pill" id="statusPill">Click a highlight</div>
        </div>

        <div class="panel-body">
          <!-- Hidden until a highlight is clicked -->
          <div id="callout" class="callout" style="display:none;">
            <!-- populated by JS -->
          </div>
        </div>
      </section>
    </div>

    <div class="bottom">
      <div class="btnrow">
        <button id="backBtn">◀ Back</button>
      </div>
      <div class="btnrow">
        <button id="nextBtn" class="btn-next">Next ▶</button>
      </div>
    </div>

  </div>

  <script src="assets/nav.js"></script>
  <script>
    const statusPill = document.getElementById("statusPill");
    const calloutEl = document.getElementById("callout");

    const HIGHLIGHTS = Array.from(document.querySelectorAll(".hl"));

    const CALLOUTS = {
      mixed: {
        title: "Mixed concerns",
        text: "This loop filters values, transforms them, and aggregates results all at once. When multiple responsibilities live together, changes in one often affect the others.",
        pill: "Mixed concerns"
      },
      predicate: {
        title: "Hidden decision logic",
        text: "The condition for “which values matter” is embedded in the loop. Reusing this rule elsewhere often means copying and pasting it.",
        pill: "Decision logic"
      },
      transform: {
        title: "Transformation tied to control flow",
        text: "The transformation only exists inside this specific loop. Changing what happens to values requires editing the loop itself.",
        pill: "Transformation"
      },
      aggregate: {
        title: "Aggregation coupled to iteration",
        text: "The accumulation logic depends on the surrounding structure. Adding another aggregation (like a count) increases complexity quickly.",
        pill: "Aggregation"
      }
    };

    function escapeHtml(s) {
      return s.replace(/[&<>"']/g, (c) => ({
        "&": "&amp;",
        "<": "&lt;",
        ">": "&gt;",
        '"': "&quot;",
        "'": "&#039;"
      }[c]));
    }

    function clearActive() {
      HIGHLIGHTS.forEach(el => el.classList.remove("active", "warn"));
    }

    function setCallout(key) {
      const c = CALLOUTS[key];
      if (!c) return;

      calloutEl.style.display = "block";
      calloutEl.innerHTML = `<h3>${escapeHtml(c.title)}</h3><p>${escapeHtml(c.text)}</p>`;
      statusPill.textContent = c.pill;
    }

    // Click handlers for code highlights
    HIGHLIGHTS.forEach(el => {
      el.addEventListener("click", () => {
        const key = el.dataset.key;

        clearActive();
        // Highlight all lines with the same key (so "mixed" can tag multiple)
        HIGHLIGHTS.filter(x => x.dataset.key === key).forEach(x => x.classList.add("active"));

        setCallout(key);
      });
    });
  </script>
</body>
</html>
